openapi: 3.0.0
info:
  title: SID Sei Rotan API
  version: 1.0.0
  description: API for Sistem Informasi Desa Sei Rotan
servers:
  - url: http://localhost:8080
    description: Development server
paths:
  /api/posts:
    get:
      summary: Get all news posts
      tags:
        - Posts
      responses:
        '200':
          description: A list of news posts
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Post'
  /api/posts/{id}:
    get:
      summary: Get a single news post by ID
      tags:
        - Posts
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
            format: int64
          description: ID of the news post to retrieve
      responses:
        '200':
          description: A single news post
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Post'
        '404':
          description: Post not found
  /api/admin/login:
    post:
      summary: Admin login
      tags:
        - Admin
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Successful login, returns JWT token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '401':
          description: Invalid credentials
  /api/admin/posts:
    post:
      summary: Create a new news post (Admin protected)
      tags:
        - Admin Posts
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreatePostRequest'
      responses:
        '201':
          description: News post created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Post'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
  /api/admin/posts/{id}:
    put:
      summary: Update a news post by ID (Admin protected)
      tags:
        - Admin Posts
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
            format: int64
          description: ID of the news post to update
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdatePostRequest'
      responses:
        '200':
          description: News post updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Post'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Post not found

  /api/officials:
    get:
      summary: Get all village officials
      tags:
        - Public
      responses:
        '200':
          description: A list of village officials
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/VillageOfficial'

  /api/potentials:
    get:
      summary: Get all village potentials
      tags:
        - Public
      responses:
        '200':
          description: A list of village potentials
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Potential'

  /api/contacts:
    post:
      summary: Submit a contact message
      tags:
        - Public
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ContactRequest'
      responses:
        '201':
          description: Message sent successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ContactResponse'
        '400':
          description: Bad request (e.g., missing fields)

  /api/admin/profile/change-password:
    put:
      summary: Change admin password
      description: Allows an authenticated admin to change their own password
      tags:
        - Admin Profile
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - current_password
                - new_password
                - confirm_password
              properties:
                current_password:
                  type: string
                  format: password
                  description: The admin's current password
                  example: "oldpassword123"
                new_password:
                  type: string
                  format: password
                  minLength: 6
                  description: The new password (minimum 6 characters)
                  example: "newpassword456"
                confirm_password:
                  type: string
                  format: password
                  description: Confirmation of the new password (must match new_password)
                  example: "newpassword456"
      responses:
        '200':
          description: Password changed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Password changed successfully"
        '400':
          description: Bad request (validation error)
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "new password must be at least 6 characters"
        '401':
          description: Unauthorized (invalid or missing token)
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Invalid or expired token"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Failed to update password"

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    Post:
      type: object
      properties:
        id:
          type: integer
          format: int64
          example: 1
        title:
          type: string
          example: "Judul Berita Terbaru"
        slug:
          type: string
          example: "judul-berita-terbaru"
        content:
          type: string
          example: "Isi lengkap berita..."
        featured_image_url:
          type: string
          format: url
          nullable: true
          example: "http://example.com/image.jpg"
        status:
          type: string
          enum: [draft, published, archived]
          example: "published"
        author_id:
          type: integer
          format: int64
          example: 1
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        deleted_at:
          type: string
          format: date-time
          nullable: true
    VillageOfficial:
      type: object
      properties:
        id:
          type: integer
          format: int64
          example: 1
        name:
          type: string
          example: "Nama Pejabat"
        position:
          type: string
          example: "Kepala Desa"
        photo_url:
          type: string
          format: url
          nullable: true
          example: "http://example.com/photo.jpg"
        bio:
          type: string
          nullable: true
          example: "Biografi singkat pejabat..."
        display_order:
          type: integer
          example: 1
    Potential:
      type: object
      properties:
        id:
          type: integer
          format: int64
          example: 1
        title:
          type: string
          example: "Potensi Pertanian"
        description:
          type: string
          nullable: true
          example: "Deskripsi potensi pertanian..."
        cover_image_url:
          type: string
          format: url
          nullable: true
          example: "http://example.com/cover.jpg"
        type:
          type: string
          enum: [umkm, tourism, agriculture, other]
          example: "agriculture"
    ContactRequest:
      type: object
      required:
        - name
        - email
        - subject
        - message
      properties:
        name:
          type: string
          example: "John Doe"
        email:
          type: string
          format: email
          example: "john.doe@example.com"
        subject:
          type: string
          example: "Pertanyaan tentang layanan"
        message:
          type: string
          example: "Saya ingin bertanya mengenai..."
    ContactResponse:
      type: object
      properties:
        message:
          type: string
          example: "Message sent successfully!"
    LoginRequest:
      type: object
      required:
        - username
        - password
      properties:
        username:
          type: string
          example: "admin"
        password:
          type: string
          example: "password123"
    LoginResponse:
      type: object
      properties:
        token:
          type: string
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
    CreatePostRequest:
      type: object
      required:
        - title
        - content
        - author_id
      properties:
        title:
          type: string
          example: "Judul Berita Baru"
        content:
          type: string
          example: "Isi berita yang baru dibuat..."
        featured_image_url:
          type: string
          format: url
          nullable: true
          example: "http://example.com/new-image.jpg"
        status:
          type: string
          enum: [draft, published, archived]
          example: "draft"
        author_id:
          type: integer
          format: int64
          example: 1
    UpdatePostRequest:
      type: object
      properties:
        title:
          type: string
          example: "Judul Berita Diperbarui"
        content:
          type: string
          example: "Isi berita yang sudah diupdate..."
        featured_image_url:
          type: string
          format: url
          nullable: true
          example: "http://example.com/updated-image.jpg"
        status:
          type: string
          enum: [draft, published, archived]
          example: "published"
